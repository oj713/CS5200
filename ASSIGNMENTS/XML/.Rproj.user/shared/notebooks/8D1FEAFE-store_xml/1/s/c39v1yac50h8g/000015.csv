"0","# helper function that creates a list for a book entry "
"0","processBook <- function(book, cid) {"
"0","  # helper method to extract text for an element"
"0","  book_elem <- function(elem, type = ""character"") {"
"0","    xpathSApply(book, paste0(elem, ""/text()""))[[1]] |> as(type)"
"0","  }"
"0","  "
"0","  # mandatory elements"
"0","  id <- xpathSApply(book, ""@id"")"
"0","  title <- book_elem(""title"")"
"0","  price <- book_elem(""price"", type = ""numeric"")"
"0","  publish_date <- book_elem(""publish_date"")"
"0","  description <- book_elem(""description"")"
"0","  "
"0","  # optional elements"
"0","  edition <- book_elem(""edition"", type = ""numeric"")"
"0","  if (length(edition) == 0) {edition <- NA}"
"0","  "
"0","  # references"
"0","  genre <- which(genres == book_elem(""genre""))"
"0","  author <- which(authors == book_elem(""author""))"
"0","  catalog <- cid"
"0","  "
"0","  list(""id"" = id, 'title' = title, 'edition' = edition, 'price' = price, "
"0","       'publish_date' = publish_date, 'description' = description, "
"0","       'genre' = genre, 'author' = author, 'catalog' = catalog)"
"0","}"
"0",""
"0","# defining books base"
"0","books_df <- data.frame (id = character(0),"
"0","                       title = character(0),"
"0","                       edition = numeric(0),"
"0","                       price = numeric(0),"
"0","                       publish_date = character(0),"
"0","                       description = character(0),"
"0","                       genre = numeric(0),"
"0","                       author = numeric(0), "
"0","                       catalog = numeric(0), "
"0","                       stringsAsFactors = F)"
"0",""
"0","# iterating through catalogs and by extension, books to create table"
"0","for (cid in catalogs_df$cid) {"
"0","  catalog <- catalogs[[cid]]"
"0","  "
"0","  books <- xpathSApply(catalog, ""book"")"
"0","  "
"0","  books_df <- do.call(rbind.data.frame, "
"0","                      lapply(books, processBook, cid)) |>"
"0","    rbind(books_df)"
"0","}"
"0",""
"0","head(books_df)"
